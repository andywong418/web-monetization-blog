<html>
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">
  <link rel="stylesheet" href="./stylesheets/style.css">
</head>

<body>
  <header>
    <div class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#"><i class="fas fa-lemon"></i>Foodie Blog</a>
    </div>
  </header>

  <div id="recipe_view" class="modal">
    <span class="close" onclick="close_modal()">&times;</span>
    <div id="recipe_view_content" class="card modal-content col-md-6 offset-md-3">
      <img id="card-img" class="card-img-top" src="./images/lamb-ragu_1801.jpg" alt="Card image cap">
      <div class="card-body text-center">
        <h5 id="card-title" class="card-title"></h5>
        <p id="card-text" class="card-text"></p>
        <a href="#" class="btn btn-primary">Isn't this cool? Check out our site!</a>
    </div>

    </div>
  </div>

  <main>
    <section class="text-center demo-text">
      <div class="container">
          <h1 class="jumbotron-heading">Foodie - the first web monetised recipe blog</strong>
          <p class="lead text-muted showoff">This is a demo site to show off the capabilities of <a href="https://github.com/interledger/rfcs/blob/master/0028-web-monetization/0028-web-monetization.md">Web Monetization</a> and <a href="https://interledger.org">Interledger</a>.</p>
          <p class="lead text-muted turn"> Turn on your extensions to read a recipe!</p>
          <p class="lead text-muted"> All images are from <a href="http://iamafoodblog.com/">iamafoodblog</a>.
      </div>
    </section>
    <section class="recipes">
      <div class="row">
        <div class="col-md-4 text-center">
          <div class="text-center recipe">

            <img class="food-img" src="./images/lamb-ragu_1801.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Spicy Lamb Ragu')"> Spicy Lamb Ragu </a> </p>
            <p class="lead text-muted">Time to make: 30 mins</p>
            <p class="lead text-muted">Price: $$</p>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <div class="text-center recipe">

            <img class="food-img" src="./images/lemongrass-chicken-recipe_4.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Lemongrass Chicken')"> Lemongrass Chicken </a> </p>
            <p class="lead text-muted">Time to make: 20 mins</p>
            <p class="lead text-muted">Price: $</p>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <div class="text-center recipe">

            <img class="food-img" src="./images/DSC_2483.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Tokyo Tonkotsu Ramen')"> Tokyo Tonkotsu Ramen </a> </p>
            <p class="lead text-muted">Time to make: 80 mins</p>
            <p class="lead text-muted">Price: $</p>
          </div>
        </div>
    </div>
    </section>
  </main>
  <script src="/client.js"></script>
  <script>

  getMonetizationId('http://localhost:8080/pay/:id')
    .then(id => {
      window.monetizationId = id
    })

  function close_modal() {
    const modal = document.getElementById('recipe_view')
    modal.style = 'display: none;'
  }
  function readRecipe(e, name) {
    e.preventDefault();
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if(this.readyState === 4 && this.status == 200) {
        const modal = document.getElementById('recipe_view')
        const cardTitle = document.getElementById('card-title')
        const cardText = document.getElementById('card-text')
        const cardImage = document.getElementById('card-img')
        switch (this.responseText) {
          case 'Spicy Lamb Ragu':
            cardImage.src= './images/lamb-ragu_1801.jpg'
            break
          case 'Lemongrass Chicken':
            cardImage.src="./images/lemongrass-chicken-recipe_4.jpg"
            break
          case 'Tokyo Tonkotsu Ramen':
            cardImage.src="./images/DSC_2483.jpg"
            break
          default:

        }
        modal.style = 'display: flex;'
        cardTitle.innerHTML = this.responseText
        cardText.innerHTML = 'Sample recipe for ' + this.responseText
      }
    }
    xhttp.open("GET", 'http://localhost:8080/content/' + window.monetizationId + '/' + name)
    xhttp.send()
  }
  </script>
</body>
</html>
