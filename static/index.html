<html>
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Cedarville+Cursive" rel="stylesheet">
  <link rel="stylesheet" href="./stylesheets/style.css">
</head>

<body>
  <header>
    <div class="navbar navbar-expand-lg navbar-light">
      <a class="navbar-brand" href="#"><i class="fas fa-lemon"></i>Foodie Blog</a>
      <ul class="navbar-nav ml-auto">
        <li><a class="nav-item nav-link active" href="#"><i class="fab fa-twitter"></i></a></li>
        <a class="nav-item nav-link" href="#"><i class="fab fa-facebook"></i></a>
        <a class="nav-item nav-link" href="#"><i class="fab fa-instagram"></i></a>
      </div>
    </div>

  </header>

  <div id="recipe_view" class="modal">
    <span class="close" onclick="close_modal()">&times;</span>
    <div id="recipe_view_content" class="card modal-content col-md-6 offset-md-3">
      <img id="card-img" class="card-img-top" src="" alt="Card image cap">
      <div class="card-body text-center">
        <h5 id="card-title" class="card-title"></h5>
        <p id="card-text" class="card-text"></p>
        <a href="#" class="btn btn-primary">Isn't this cool? Check out our site!</a>
    </div>

    </div>
  </div>

  <main>
    <section class="text-center demo-text">
      <div class="container">
          <h1 class="jumbotron-heading">Foodie - the first web monetised recipe blog</strong>
          <p class="lead text-muted showoff">This is a demo site to show off the capabilities of <a href="https://github.com/interledger/rfcs/blob/master/0028-web-monetization/0028-web-monetization.md">Web Monetization</a> and <a href="https://interledger.org">Interledger</a>.</p>
          <p class="lead text-muted turn"> Turn on your extensions to read a recipe! If you don't pay you can only see two for free.</p>
          <p class="lead text-muted"> All images are from <a href="http://iamafoodblog.com/">iamafoodblog</a>.
      </div>
    </section>
    <section class="recipes">
      <div class="row">
        <div class="col-md-4 text-center">
          <div class="text-center recipe">
            <img class="food-img" src="./images/lamb-ragu_1801.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Spicy Lamb Ragu')"> Spicy Lamb Ragu </a> </p>
            <p class="lead text-muted">Time to make: 30 mins</p>
            <p class="lead text-muted">Price: $$</p>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <div class="text-center recipe">

            <img class="food-img" src="./images/lemongrass-chicken-recipe_4.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Lemongrass Chicken')"> Lemongrass Chicken </a> </p>
            <p class="lead text-muted">Time to make: 20 mins</p>
            <p class="lead text-muted">Price: $</p>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <div class="text-center recipe">

            <img class="food-img" src="./images/DSC_2483.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Tokyo Tonkotsu Ramen')"> Tokyo Tonkotsu Ramen </a> </p>
            <p class="lead text-muted">Time to make: 80 mins</p>
            <p class="lead text-muted">Price: $</p>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 text-center">
          <div class="text-center recipe">
            <img class="food-img" src="./images/yoshinoya-gyudon-recipe_5786.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Yoshinoya Gyudon')"> Yoshinoya Gyudon </a> </p>
            <p class="lead text-muted">Time to make: 15 mins</p>
            <p class="lead text-muted">Price: $$</p>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <div class="text-center recipe">

            <img class="food-img" src="./images/IAM_8210.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Malaysian Roti')"> Malaysian Roti </a> </p>
            <p class="lead text-muted">Time to make: 5 mins</p>
            <p class="lead text-muted">Price: $</p>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <div class="text-center recipe">

            <img class="food-img" src="./images/instant-pot-bo-kho-recipe_7469.jpg"/>
            <small class="text-success">$ Paid Content</small>
            <p class="recipe-text"> <a href="#" onclick="readRecipe(event, 'Pot Bo Kho')"> Pot Bo Kho </a> </p>
            <p class="lead text-muted">Time to make: 40 mins</p>
            <p class="lead text-muted">Price: $</p>
          </div>
        </div>
      </div>
    </section>
  </main>
  <footer>
    <div class="link-container">
      <p><a href="https://interledger.org"> Interledger </a> </p>
      <p><a href="https://github.com/interledger/rfcs/blob/master/0028-web-monetization/0028-web-monetization.md"> Web Monetization </a></p>
      <p><a href="https://getflat.com/sites/browse"> Other Examples </a></p>
    </div>
    <p>Interledger Â© 2018 </p>
  </footer>
  <script src="/client.js"></script>
  <script>

  getMonetizationId('http://localhost:8080/pay/:id')
    .then(id => {
      window.monetizationId = id
    })

  function close_modal() {
    const modal = document.getElementById('recipe_view')
    modal.style = 'display: none;'
  }

  function showRecipe(data) {
    const modal = document.getElementById('recipe_view')
    const cardTitle = document.getElementById('card-title')
    const cardText = document.getElementById('card-text')
    const cardImage = document.getElementById('card-img')
    modal.style = 'display: flex;'
    switch (data) {
      case 'Spicy Lamb Ragu':
        cardImage.src= './images/lamb-ragu_1801.jpg'
        break
      case 'Lemongrass Chicken':
        cardImage.src="./images/lemongrass-chicken-recipe_4.jpg"
        break
      case 'Tokyo Tonkotsu Ramen':
        cardImage.src="./images/DSC_2483.jpg"
        break
      case 'Yoshinoya Gyudon':
        cardImage.src="./images/yoshinoya-gyudon-recipe_5786.jpg"
        break
      case 'Malaysian Roti':
        cardImage.src="./images/IAM_8210.jpg"
        break
      case 'Pot Bo Kho':
        cardImage.src="./images/instant-pot-bo-kho-recipe_7469.jpg"
        break
      default:
        cardImage.src="./images/ilp_logo.svg"

      }
      cardTitle.innerHTML = data
      cardText.innerHTML = "Sample recipe for " + data
  }

  function readRecipe(e, name) {
    e.preventDefault();

    fetch('http://localhost:8080/content/' + window.monetizationId + '/' + name)
      .then(response => {
        if(!response.ok) {
          throw Error("ID undefined");
        }
        return response.text();
      })
      .then(data => {
        showRecipe(data);
      })
      .catch(err => {
        const count = parseInt(localStorage.getItem('count'));
        const recipeName = localStorage.getItem(name);
        if(count && count >= 2 && !recipeName) {
          const modal = document.getElementById('recipe_view')
          const cardTitle = document.getElementById('card-title')
          const cardText = document.getElementById('card-text')
          const cardImage = document.getElementById('card-img')
          cardImage.src="./images/ilp_logo.svg"
          cardTitle.innerHTML = ""
          cardText.innerHTML = "You have exceeded your free recipe count! Please turn on your extension and refresh the page."
          modal.style = 'display: flex;'
          cardImage.style="width: 70%; margin-left: 15%"
        } else {
          showRecipe(name);
          if(count && count <= 2 && !recipeName) {
            localStorage.setItem('count', count + 1)
            localStorage.setItem(name, true);
          }
          if(!count) {
            localStorage.setItem('count', 1)
            localStorage.setItem(name, name);
          }
        }
      })
  }
  </script>
</body>
</html>
